<!doctype html>
<html>
    <head>
        <title>Register</title>
    </head>
    <body>
        <h2>Register</h2>
        <form id="registerForm">
            <input id="username" placeholder="Username" required />
            <input
                id="password"
                type="password"
                placeholder="Password"
                required
            />
            <button type="submit">Register</button>
        </form>

        <script>
            document
                .getElementById("registerForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const username = document
                        .getElementById("username")
                        .value.trim();
                    const password = document
                        .getElementById("password")
                        .value.trim();

                    console.log("Input:", { username, password });

                    const payload = { username, password };
                    console.log("JSON sent:", JSON.stringify(payload));

                    try {
                        const res = await fetch(
                            "http://localhost:5000/register",
                            {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(payload),
                            },
                        );

                        console.log("HTTP Status:", res.status);

                        const data = await res.json();
                        console.log("Response JSON:", data);

                        if (data.data && data.data.error) {
                            console.log("Register error:", data.data.error);
                        } else if (data.data && data.data.token) {
                            console.log(
                                "Register success! Token:",
                                data.data.token,
                            );
                            localStorage.setItem("token", data.data.token);
                            console.log("Token stored in localStorage.");
                        } else {
                            console.log("Unexpected response structure");
                        }
                    } catch (err) {
                        console.log("Network or server error:", err);
                    }
                });
        </script>
    </body>
</html>
